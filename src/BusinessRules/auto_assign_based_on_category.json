{
    "sys_id": "a1b2c3d4e5f6g7h8i9j0",
    "name": "Auto Assign Based on Category",
    "collection": "incident",
    "when": "before",
    "operation": "insert",
    "order": 100,
    "description": "Automatically assigns incidents to the appropriate assignment group based on the category",
    "script": "/**\n * Business Rule: Auto Assign Based on Category\n * Table: incident\n * When: before\n * Operation: insert\n * \n * Automatically assigns incidents to the appropriate assignment group based on the category\n */\n(function executeRule(current, previous /*null when async*/) {\n\n    // Only proceed if the incident doesn't already have an assignment group\n    if (!current.assignment_group.nil()) {\n        gs.info('Incident already has assignment group: ' + current.assignment_group.getDisplayValue());\n        return;\n    }\n    \n    // Define category to group mappings\n    var categoryToGroupMap = {\n        'hardware': 'Hardware Support', // Group names, would use sys_ids in production\n        'software': 'Software Support',\n        'network': 'Network Support',\n        'database': 'Database Support',\n        'security': 'Security Team'\n    };\n    \n    // Convert to lowercase for case-insensitive matching\n    var category = current.category.toString().toLowerCase();\n    \n    // Check if we have a mapping for this category\n    if (categoryToGroupMap.hasOwnProperty(category)) {\n        var groupName = categoryToGroupMap[category];\n        \n        // Look up the group by name\n        var grp = new GlideRecord('sys_user_group');\n        grp.addQuery('name', groupName);\n        grp.query();\n        \n        if (grp.next()) {\n            // Assign the incident to the appropriate group\n            current.assignment_group = grp.sys_id;\n            gs.info('Auto-assigned incident to group: ' + groupName);\n        } else {\n            gs.warn('Could not find group: ' + groupName);\n        }\n    } else {\n        // Default assignment if category doesn't match\n        var helpdesk = new GlideRecord('sys_user_group');\n        helpdesk.addQuery('name', 'Service Desk');\n        helpdesk.query();\n        \n        if (helpdesk.next()) {\n            current.assignment_group = helpdesk.sys_id;\n            gs.info('Category not matched. Assigned to default Service Desk group');\n        }\n    }\n\n})(current, previous);"
}
